<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HACKER PANEL 1.0</title>
<style>
  body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: #0f0f17;
    color: #e0e0ff;
    padding: 16px;
    max-width: 620px;
    margin: auto;
  }
  h1 {
    text-align: center;
    color: #00d4ff;
    font-size: 26px;
    letter-spacing: 1.5px;
    margin-bottom: 16px;
    text-shadow: 0 0 10px #00d4ff44;
  }
  #toggleBtn {
    width: 100%;
    padding: 16px;
    font-size: 19px;
    font-weight: bold;
    background: #00c853;
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    margin-bottom: 16px;
    box-shadow: 0 4px 12px #00c85344;
    transition: all 0.3s;
  }
  #toggleBtn.off {
    background: #ff5252;
    box-shadow: 0 4px 12px #ff525244;
  }
  #status {
    padding: 14px;
    margin-bottom: 16px;
    border-radius: 10px;
    text-align: center;
    font-weight: bold;
    background: #1a1a2e;
    border: 1px solid #333366;
  }
  #numbers {
    display: flex;
    flex-direction: column;
    gap: 14px;
  }
  .numbox {
    background: #171725;
    padding: 14px 16px;
    border-radius: 12px;
    border: 1px solid #2a2a4a;
    display: flex;
    flex-direction: column;
    gap: 10px;
    position: relative;
    box-shadow: 0 2px 10px #00000066;
    transition: all 0.3s;
  }
  .numbox:hover {
    border-color: #00d4ff66;
    box-shadow: 0 4px 18px #00d4ff22;
  }
  .numbox.copied-flash {
    background: #4a1a1a !important;
    border-color: #ff5252 !important;
    box-shadow: 0 0 20px #ff525266 !important;
    transition: all 0.4s;
  }
  .top-row {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 19px;
    font-weight: bold;
  }
  .phone10 {
    flex: 1;
    color: #a5d8ff;
    cursor: pointer;
    user-select: none;
    padding: 4px 8px;
    border-radius: 6px;
    transition: background 0.2s;
  }
  .phone10:hover {
    background: rgba(0, 212, 255, 0.12);
  }
  .copy-number-btn, .copy-otp-btn {
    padding: 8px 14px;
    font-size: 14px;
    font-weight: 600;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    min-width: 80px;
    transition: all 0.2s;
  }
  .copy-number-btn {
    background: #2962ff;
  }
  .copy-number-btn.clicked-once {
    background: #d81b60;
  }
  .copy-otp-btn {
    background: #8e24aa;
  }
  .copy-otp-btn:hover { opacity: 0.92; }

  .otp-area {
    display: flex;
    align-items: center;
    gap: 12px;
    background: #0d0d1f;
    padding: 10px;
    border-radius: 8px;
    border: 1px dashed #444488;
  }
  .otp {
    flex: 1;
    text-align: center;
    font-size: 18px;
    font-weight: bold;
    letter-spacing: 2px;
    color: #ffeb3b;
    min-height: 34px;
  }
  .otp.success {
    color: #00e676;
    animation: glow 1.5s infinite alternate;
  }
  .waiting {
    color: #ff9800;
    font-style: italic;
  }

  .rotating::after {
    content: "⟳";
    display: inline-block;
    margin-left: 8px;
    animation: spin 1.2s linear infinite;
    font-size: 18px;
  }

  @keyframes spin {
    0%   { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  @keyframes glow {
    from { text-shadow: 0 0 6px #00e67644; }
    to   { text-shadow: 0 0 18px #00e676aa, 0 0 30px #00e67666; }
  }

  .timer {
    position: absolute;
    top: 8px;
    right: 12px;
    font-size: 13px;
    color: #ff6d00;
    background: rgba(0,0,0,0.5);
    padding: 4px 8px;
    border-radius: 6px;
    font-family: 'Courier New', monospace;
  }
</style>
</head>
<body>

<h1>HACKER PANEL 1.0</h1>

<button id="toggleBtn">ON Karo</button>
<div id="status">Off hai → ON dabao</div>

<div id="numbers"></div>

<script>
const API_KEY  = "26533dbe5c115d77f9f7f6c0f428a64a";
const BASE_URL = "https://api.grizzlysms.com/stubs/handler_api.php";
const SERVICE  = "swr";
const COUNTRY  = "22";
const MAX_PRICE = "80";

const STATE_KEY   = 'hp_isOn';
const USED_KEY    = 'hp_used_numbers';
const ACTIVE_KEY  = 'hp_active_numbers';

let isOn = localStorage.getItem(STATE_KEY) === 'true';
let usedNumbers = JSON.parse(localStorage.getItem(USED_KEY)  || '[]');
let activeNumbers = JSON.parse(localStorage.getItem(ACTIVE_KEY) || '[]');

const toggleBtn  = document.getElementById('toggleBtn');
const statusDiv  = document.getElementById('status');
const numbersDiv = document.getElementById('numbers');

function updateUI() {
  toggleBtn.textContent = isOn ? 'OFF Karo' : 'ON Karo';
  toggleBtn.classList.toggle('off', !isOn);
  statusDiv.textContent = isOn ? 'Auto buy fast mode...' : 'Off hai → ON dabao';
}

toggleBtn.onclick = () => {
  isOn = !isOn;
  localStorage.setItem(STATE_KEY, isOn);
  updateUI();
  if (isOn) start();
  else clearInterval(interval);
};

function saveActive() {
  localStorage.setItem(ACTIVE_KEY, JSON.stringify(activeNumbers));
}

function isValid(phone) {
  if (!phone || phone.length !== 12) return false;
  if (!phone.startsWith("91")) return false;
  if (!/^\d{12}$/.test(phone)) return false;
  if (usedNumbers.includes(phone)) return false;
  
  usedNumbers.push(phone);
  localStorage.setItem(USED_KEY, JSON.stringify(usedNumbers));
  return true;
}

function cleanStorage() {
  const now = Date.now();
  activeNumbers = activeNumbers.filter(item =>
    item.phone && item.phone.length === 12 &&
    item.phone.startsWith("91") &&
    (now - item.startTime) < 300000
  );
  saveActive();
}

function renderSaved() {
  cleanStorage();
  numbersDiv.innerHTML = '';
  
  activeNumbers
    .sort((a,b) => b.startTime - a.startTime)
    .forEach(item => {
      const box = createNumberBox(item.phone.slice(2), item.id, item.startTime, item.otp);
      numbersDiv.appendChild(box);
      startTimer(box, item.startTime);
      if (!item.otp) startPolling(box, item.id);
    });
}

function flashBoxRed(box) {
  box.classList.add('copied-flash');
  setTimeout(() => {
    box.classList.remove('copied-flash');
  }, 1500);
}

function createNumberBox(num10, id, startTime, otp = null) {
  const box = document.createElement('div');
  box.className = 'numbox';
  box.dataset.id = id;

  const clickedClass = localStorage.getItem(`copy_${id}`) === 'once' ? 'clicked-once' : '';

  box.innerHTML = `
    <div class="top-row">
      <div class="phone10">${num10}</div>
      <button class="copy-number-btn ${clickedClass}">Copy No.</button>
    </div>

    <div class="otp-area ${otp ? '' : 'rotating'}">
      <div class="otp ${otp ? 'success' : 'waiting'}">
        ${otp || 'Waiting for OTP...'}
      </div>
      <button class="copy-otp-btn">Copy OTP</button>
    </div>

    <div class="timer">05:00</div>
  `;

  // Copy on clicking number + red flash
  const phoneEl = box.querySelector('.phone10');
  const copyNumBtn = box.querySelector('.copy-number-btn');

  const copyNumberAction = () => {
    navigator.clipboard.writeText(num10);
    flashBoxRed(box);

    if (copyNumBtn.classList.contains('clicked-once')) {
      copyNumBtn.classList.remove('clicked-once');
      localStorage.removeItem(`copy_${id}`);
    } else {
      copyNumBtn.classList.add('clicked-once');
      localStorage.setItem(`copy_${id}`, 'once');
    }
  };

  phoneEl.onclick = copyNumberAction;
  copyNumBtn.onclick = copyNumberAction;

  // Copy OTP
  const copyOtpBtn = box.querySelector('.copy-otp-btn');
  copyOtpBtn.onclick = () => {
    const otpText = box.querySelector('.otp').textContent.trim();
    if (otpText !== 'Waiting for OTP...' && otpText !== 'OTP wait...') {
      navigator.clipboard.writeText(otpText);
      copyOtpBtn.textContent = "Copied!";
      setTimeout(() => { copyOtpBtn.textContent = "Copy OTP"; }, 1800);
    }
  };

  return box;
}

function startTimer(box, startTime) {
  let remaining = 300 - Math.floor((Date.now() - startTime) / 1000);
  const timer = box.querySelector('.timer');
  
  const int = setInterval(() => {
    remaining--;
    const m = String(Math.floor(remaining/60)).padStart(2,'0');
    const s = String(remaining%60).padStart(2,'0');
    timer.textContent = `${m}:${s}`;
    
    if (remaining <= 0) {
      clearInterval(int);
      box.remove();
      activeNumbers = activeNumbers.filter(i => i.id !== box.dataset.id);
      saveActive();
    }
  }, 980);
}

function startPolling(box, id) {
  const otpEl = box.querySelector('.otp');
  const otpArea = box.querySelector('.otp-area');

  const poll = setInterval(async () => {
    const q = new URLSearchParams({ api_key: API_KEY, action: 'getStatus', id });
    try {
      const r = await fetch(BASE_URL + '?' + q);
      const t = (await r.text()).trim();
      
      if (t.startsWith('STATUS_OK')) {
        const code = t.split(':')[1];
        otpEl.textContent = code;
        otpEl.classList.add('success');
        otpArea.classList.remove('rotating');
        clearInterval(poll);
        
        const item = activeNumbers.find(i => i.id === id);
        if (item) {
          item.otp = code;
          saveActive();
        }
      }
    } catch {}
  }, 1800);
}

let interval;

async function fetchNumber() {
  if (!isOn) return;
  
  const p = new URLSearchParams({
    api_key: API_KEY,
    action: 'getNumber',
    service: SERVICE,
    country: COUNTRY,
    maxPrice: MAX_PRICE
  });

  try {
    const res = await fetch(BASE_URL + '?' + p);
    const txt = (await res.text()).trim();
    
    if (txt.startsWith('ACCESS_NUMBER')) {
      const [_, id, full] = txt.split(':');
      if (!isValid(full)) return;

      const startTime = Date.now();
      const item = { id, phone: full, startTime, otp: null };
      activeNumbers.unshift(item);
      saveActive();

      const box = createNumberBox(full.slice(2), id, startTime);
      numbersDiv.prepend(box);

      startTimer(box, startTime);
      startPolling(box, id);
    }
  } catch {}
}

function start() {
  fetchNumber();
  interval = setInterval(fetchNumber, 1200);
}

updateUI();
renderSaved();
if (isOn) start();
</script>
</body>
</html>
